<!DOCTYPE html>
<html lang="en">

<head>
    <title>Scribble.rs - Game</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="/resources/style.css" />
    <link rel="stylesheet" type="text/css" href="/resources/lobby.css" />
    <link rel="stylesheet" type="text/css" href="/resources/lobby_players.css" />
    <link rel="icon" type="image/png" href="/resources/favicon.png" />

    <script>
        function httpGetAsync(theUrl, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", theUrl, true);
            xhr.onload = function (e) {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        callback(xhr);
                    } else {
                        console.error(xhr.statusText);
                    }
                }
            };
            xhr.onerror = function (e) {
                console.error(xhr.statusText);
            };
            xhr.send(null);
        }

        console.log("Attempting Connection...");
        let socket = new WebSocket("ws://" + location.hostname + ":8080/ws?id={{.LobbyID}}");

        socket.onopen = () => {
            console.log("Successfully Connected");
        };

        socket.onmessage = event => {
            if (JSON.parse(event.data).Type === 1) {
                var playerContainer = document.getElementById("player-container")

                httpGetAsync("/lobby/players?id={{.LobbyID}}", response => {
                    console.log(response.responseText)
                    playerContainer.innerHTML = response.responseText
                })
            }
        };

        socket.onclose = event => {
            console.log("Socket Closed Connection: ", event);
        };

        socket.onerror = error => {
            console.log("Socket Error: ", error);
        };
    </script>
</head>

<body>
    <div class="content-wrapper">
        <div class="lobby-header">
            <span class="guess-letter guess-letter-nonspace">W</span>
            <span class="guess-letter guess-letter-nonspace">O</span>
            <span class="guess-letter guess-letter-nonspace">R</span>
            <span class="guess-letter guess-letter-nonspace">L</span>
            <span class="guess-letter guess-letter-nonspace">D</span>
            <span class="guess-letter">&nbsp;</span>
            <span class="guess-letter guess-letter-nonspace">W</span>
            <span class="guess-letter guess-letter-nonspace">A</span>
            <span class="guess-letter guess-letter-nonspace">R</span>
        </div>
        <div class="lobby-layout">
            <div id="player-container">
                {{template "players" .Players}}
            </div>
            <canvas class="drawing-board"></canvas>
            <div class="chat">
                <div>
                    Message 1<br />Message 2
                </div>
                <input type="message" placeholder="Type your message" />
            </div>
        </div>
    </div>

    {{template "footer"}}
</body>

</html>